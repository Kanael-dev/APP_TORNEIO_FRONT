<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <div id="test">
        <p id="status">Test</p>
    </div>

    <script>
        const url = "https://app-torneio.onrender.com";
        const requestForms = "/app_status/forms"
        const atualizarForms = "/app_status/"
        const formsAtivo = "/forms"
        const requestFormsInformations = "/valide_forms"
        const requestAddUser = "/players"
        let idFormsGeneral = null
        const tokenUser = localStorage.getItem("authToken")
        console.log(tokenUser)
        const options = {
            method: "get",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + tokenUser
            },
            //body: JSON.stringify(data),
        };
        fetch(url + requestForms, options)
        .then((response) => response.json())
        .then((data) => {
            const allFormsGen = data["forms"]
            allFormsGen.forEach((src, index) => {
                const teste = document.getElementById("test")
                const link = document.createElement("button");
                link.value = allFormsGen[index]["id"]; 
                if(allFormsGen[index]["status"] == 0){
                    link.textContent = "Desativado"
                } else {
                    link.textContent = "Ativado"
                }

                
                link.addEventListener("click", function (event) {
                    event.preventDefault();  
                    if(allFormsGen[index]["status"] == 0){
                         requestChangeForms(allFormsGen[index]["id"], 1)
                    } else {
                         requestChangeForms(allFormsGen[index]["id"], 0)
                    }
                });

                teste.appendChild(link);
            });
        })
        .catch((error) => console.error("Error:", error));

        function requestChangeForms(idForms, status){
            const optionsPUT = {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + tokenUser
                },
                body: JSON.stringify({"status": status}),
            };
            const urlAtualizar = url + atualizarForms + idForms
            console.log(urlAtualizar)
            fetch(urlAtualizar, optionsPUT)
            .then((response) => response.json())
            .then((data) => {
                console.log(data)
            })
            .catch((error) => console.error("Error:", error));

        }
    </script>

    <!-- <script>
        const tokenAtual = localStorage.getItem("authToken")

        if(tokenAtual == null){
            alert("Voce nao tem permissao para acessar aqui")
            window.location.href="./login.html"
        } else {
            alert("Voce esta authenticado")
        }
    </script> -->
</body>
</html>